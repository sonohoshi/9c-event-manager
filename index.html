<!DOCTYPE html>
<html>
<head>
    <title>Document and Event JSON Generator</title>
    <style>
        .content {
            margin-top: 20px;
        }
        .pretty-box {
            padding: 10px;
            border: 5px solid #000000;
        }
        pre {
            white-space: pre-line;
            border: 1px solid #ff0000;
            padding: 10px;
            user-select: all;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Document and Event JSON Generator</h1>

    <button onclick="toggleSection('markdownSection')">Markdown Converter</button>
    <button onclick="toggleSection('eventSection')">인게임 공지 데이터 관리</button>

    <div id="markdownSection" class="content hidden">
        <input type="file" id="fileInput">
        <pre id="outputText"></pre>
        <p>Select the above text and copy it using right click or keyboard shortcuts.</p>
    </div>

    <div id="eventSection" class="content hidden">
        <button id="getJson">현재 데이터 가져오기</button>
        <button id="printJson">현재 데이터 출력하기</button>
        <br>

        <div class="pretty-box">
            <label for="priorityInput">우선순위(작을수록 앞에 옵니다):</label>
            <input type="number" id="priorityInput" placeholder="우선순위"><br><br>

            <label for="bannerImageInput">배너 이미지 파일(223*68):</label>
            <input type="file" id="bannerImageInput" accept="image/*"><br><br>

            <label for="popupImageInput">팝업 이미지 파일(600*420):</label>
            <input type="file" id="popupImageInput" accept="image/*"><br><br>

            <label for="useDateTime">기간제 이벤트 여부:</label>
            <input type="checkbox" id="useDateTime"><br><br>

            <label for="beginDateTimeInput">이벤트 시작 날짜:</label>
            <input type="datetime-local" id="beginDateTimeInput"><br><br>

            <label for="endDateTimeInput">이벤트 종료 날짜:</label>
            <input type="datetime-local" id="endDateTimeInput"><br><br>

            <label for="urlInput">URL:</label>
            <input type="text" id="urlInput" placeholder="URL"><br><br>

            <label for="useAgentAddress">유저 정보(Address) 사용 여부:</label>
            <input type="checkbox" id="useAgentAddress"><br><br>

            <label for="descriptionInput">설명(관리할때 사용하는 값으로 유저에겐 안보입니다. 영어로 적어주세요):</label>
            <input type="text" id="descriptionInput" placeholder="설명"><br><br>

            <button id="generateButton">위 정보를 통해 이벤트 안내 데이터 추가</button>
        </div>

        <h2>JSON 결과</h2>
        <pre id="outputJson"></pre>
    </div>

    <script>
        function toggleSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content').forEach(section => {
                section.classList.add('hidden');
            });

            // Show the selected section
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // Markdown Converter
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result.replace(/\n/g, '\\n');
                    document.getElementById('outputText').textContent = content;
                };
                reader.readAsText(file);
            }
        });

        // Event JSON Generator
        // ... (Event JSON Generator JavaScript 코드를 여기에 추가) ...
        function inputToRenderTable(){
            const priority = parseInt(document.getElementById('priorityInput').value);
            const bannerImageName = document.getElementById('bannerImageInput').files[0]?.name.split('.')[0];
            const popupImageName = document.getElementById('popupImageInput').files[0]?.name.split('.')[0];
            const useDateTime = document.getElementById('useDateTime').checked;
            const beginDateTime = useDateTime ? document.getElementById('beginDateTimeInput').value + ':00' : '';
            const endDateTime = useDateTime ? document.getElementById('endDateTimeInput').value + ':00' : '';
            const url = document.getElementById('urlInput').value;
            const useAgentAddress = document.getElementById('useAgentAddress').checked;
            const description = document.getElementById('descriptionInput').value;

            const jsonOutput = {
                Priority: priority,
                BannerImageName: bannerImageName,
                PopupImageName: popupImageName,
                UseDateTime: useDateTime,
                BeginDateTime: beginDateTime,
                EndDateTime: endDateTime,
                Url: url,
                UseAgentAddress: useAgentAddress,
                Description: description
            };

            var realJson = new Object()
            realJson.Banners = runtimeList
            document.getElementById('outputJson').textContent = JSON.stringify(realJson, null, 0);
            runtimeList.push(jsonOutput)
            renderTable(runtimeList)
        }

        document.getElementById('generateButton').addEventListener('click', inputToRenderTable);

        // Event JSON Modifier
        // ... (Event JSON Modifier JavaScript 코드를 여기에 추가) ...
        var runtimeList = Array();
        var tableElement;
        function renderTable(serializedList){
            runtimeList = serializedList
            if(tableElement != null){
                tableElement.remove()
                console.log("remove table")
            }
            // creates a <table> element and a <tbody> element
            const tbl = document.createElement("table");
            tableElement = tbl
            tbl.id = "tableElement"
            const tblBody = document.createElement("tbody");
            var firstRow = document.createElement("tr");
            var tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("삭제 버튼"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("배너 파일 이름"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("팝업 파일 이름"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("배너 이미지"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("팝업 이미지"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("이벤트 시작 날짜"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("이벤트 종료 날짜"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("이벤트 url"))
            firstRow.appendChild(tdElement)
            tdElement = document.createElement("td")
            tdElement.appendChild(document.createTextNode("이벤트 설명"))
            firstRow.appendChild(tdElement)
            tblBody.appendChild(firstRow)

            serializedList.sort((a,b) => a.Priority - b.Priority);
            // creating all cells
            serializedList.forEach(s => {
                const row = document.createElement("tr");

                const buttonTd = document.createElement("td")
                const removeButton = document.createElement("button")
                removeButton.textContent = "삭제"
                removeButton.onclick = e => {
                    const index = runtimeList.findIndex(data => data.Description == s.Description)
                    runtimeList.splice(index,1)
                    renderTable(runtimeList)
                }
                buttonTd.appendChild(removeButton)
                row.appendChild(buttonTd);

                const bannerNameTd = document.createElement("td")
                bannerNameTd.appendChild(document.createTextNode(`${s.BannerImageName}`))
                row.appendChild(bannerNameTd);

                const popupNameTd = document.createElement("td")
                popupNameTd.appendChild(document.createTextNode(`${s.PopupImageName}`))
                row.appendChild(popupNameTd);

                const bannerTd = document.createElement("td")
                const banner = document.createElement("img")
                banner.src = `${document.getElementById('bannerImageInput').files[0]?.name.split(".")[0] == s.BannerImageName ? URL.createObjectURL(document.getElementById('bannerImageInput').files[0]) : `https://raw.githubusercontent.com/planetarium/NineChronicles.LiveAssets/main/Assets/Images/Banner/${s.BannerImageName}.png`}`
                bannerTd.appendChild(banner)
                row.appendChild(bannerTd);

                const popupTd = document.createElement("td")
                const popup = document.createElement("img")
                popup.src = `${document.getElementById('popupImageInput').files[0]?.name.split(".")[0] == s.PopupImageName ? URL.createObjectURL(document.getElementById('bannerImageInput').files[0]) : `https://raw.githubusercontent.com/planetarium/NineChronicles.LiveAssets/main/Assets/Images/Notice/${s.PopupImageName}.png`}`
                popup.width = 300
                popup.height = 210
                popupTd.appendChild(popup)
                row.appendChild(popupTd);

                const beginDateTimeTd = document.createElement("td")
                beginDateTimeTd.appendChild(document.createTextNode(`${s.BeginDateTime}`))
                row.appendChild(beginDateTimeTd)

                const endDateTimeTd = document.createElement("td")
                endDateTimeTd.appendChild(document.createTextNode(`${s.EndDateTime}`))
                row.appendChild(endDateTimeTd)

                const urlTd = document.createElement("td")
                urlTd.appendChild(document.createTextNode(`${s.Url}`))
                row.appendChild(urlTd)

                const descriptionTd = document.createElement("td")
                descriptionTd.appendChild(document.createTextNode(`${s.Description}`))
                row.appendChild(descriptionTd)

                // add the row to the end of the table body
                tblBody.appendChild(row);
            });

            // put the <tbody> in the <table>
            tbl.appendChild(tblBody);
            tbl.setAttribute("border", "2");

            // appends <table> into <body>
            document.body.appendChild(tbl);
        }

        document.getElementById('getJson').addEventListener('click', async function() {
            const response = await fetch('https://raw.githubusercontent.com/planetarium/NineChronicles.LiveAssets/main/Assets/Json/Event.json',
            {
                method: 'GET',
            });
            const json = await response.json();
            await renderTable(json.Banners)
            runtimeList.forEach(s => console.log(s))
        });
        document.getElementById('printJson').addEventListener('click', function() {
            if(runtimeList.length > 0){
                const jsonList = new Object()
                jsonList.Banners = runtimeList
                console.log(JSON.stringify(jsonList, null, 4))
            }
        });
    </script>
</body>
</html>
